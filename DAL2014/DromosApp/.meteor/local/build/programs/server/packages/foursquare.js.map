{"version":3,"file":"/packages/foursquare.js","sources":["foursquare/foursquare_server.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,gB;;AAEA,8D;;AAEA,0C;AACA,0C;;AAEA,U;AACA,kB;AACA,sB;AACA,+B;AACA,mC;AACA,M;AACA,c;AACA,gB;AACA,sC;AACA,mC;AACA,O;AACA,K;AACA,I;AACA,G;;AAEA,yB;AACA,mB;AACA,oC;;AAEA,uC;AACA,oF;AACA,c;AACA,yE;;AAEA,e;AACA,O;AACA,yB;AACA,qD;AACA,kB;AACA,qC;AACA,iC;AACA,U;AACA,iB;AACA,2B;AACA,qC;AACA,uC;AACA,2C;AACA,sE;AACA,sC;AACA,S;AACA,S;AACA,iB;AACA,mG;AACA,6C;AACA,G;AACA,8F;AACA,kG;AACA,U;AACA,sC;AACA,G;AACA,E;;AAEA,0C;AACA,O;AACA,oB;AACA,mD;AACA,2C;AACA,0C;AACA,4B;AACA,iB;AACA,yF;AACA,6C;AACA,G;AACA,E;;;AAGA,2D;AACA,mD;AACA,E","sourcesContent":["Foursquare = {};\n\nOauth.registerService('foursquare', 2, null, function(query) {\n\n  var accessToken = getAccessToken(query);\n  var identity = getIdentity(accessToken);\n\n  return {\n    serviceData: {\n      id: identity.id,\n      accessToken: accessToken,\n      email: identity.contact.email\n    },\n    options: {\n      profile: {\n        firstName: identity.firstName,\n        lastName: identity.lastName\n      }\n    }\n  };\n});\n\nvar userAgent = \"Meteor\";\nif (Meteor.release)\n  userAgent += \"/\" + Meteor.release;\n\nvar getAccessToken = function (query) {\n  var config = ServiceConfiguration.configurations.findOne({service: 'foursquare'});\n  if (!config)\n    throw new ServiceConfiguration.ConfigError(\"Service not configured\");\n\n  var response;\n  try {\n    response = HTTP.post(\n      \"https://foursquare.com/oauth2/access_token\", {\n        headers: {\n          Accept: 'application/json',\n          \"User-Agent\": userAgent\n        },\n        params: {\n          code: query.code,\n          client_id: config.clientId,\n          client_secret: config.secret,\n          grant_type: 'authorization_code',\n          redirect_uri: Meteor.absoluteUrl(\"_oauth/foursquare?close\"),\n          state: query.credentialToken\n        }\n      });\n  } catch (err) {\n    throw _.extend(new Error(\"Failed to complete OAuth handshake with Foursquare. \" + err.message),\n                   {response: err.response});\n  }\n  if (response.data.error) { // if the http response was a json object with an error attribute\n    throw new Error(\"Failed to complete OAuth handshake with Foursquare. \" + response.data.error);\n  } else {\n    return response.data.access_token;\n  }\n};\n\nvar getIdentity = function (accessToken) {\n  try {\n    return HTTP.get(\n      \"https://api.foursquare.com/v2/users/self\", {\n        headers: {\"User-Agent\": userAgent},\n        params: {oauth_token: accessToken}\n      }).data.response.user;\n  } catch (err) {\n    throw _.extend(new Error(\"Failed to fetch identity from Foursquare. \" + err.message),\n                   {response: err.response});\n  }\n};\n\n\nFoursquare.retrieveCredential = function(credentialToken) {\n  return Oauth.retrieveCredential(credentialToken);\n};\n"]}